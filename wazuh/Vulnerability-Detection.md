# Vulnerability Detection
Wazuh’s Vulnerability Detection module uses one of the following vulnerability sources:
* Wazuh vulnerabilities repository in the Cyber Threat Intelligence (CTI) platform
* Offline vulnerabilities repository  -  a locally hosted copy of Wazuh’s CTI threat intelligence repository.

The Wazuh Agent collects a list of installed applications and sends it to the Wazuh Server. The Vulnerability Detector module then correlates this software inventory data with vulnerability information obtained from the remote or local CTI vulnerability repository. Wazuh’s CTI is comprised from a collection of vulnerability data from various trusted sources, such as operating system vendors and public vulnerability databases. 

Wazuh Agent’s Syscollector module collects detailed system inventory data, which includes information about operating system and installed packages. This data is periodically sent to the Wazuh Server and stored in a SQL database. 

When a match is identified between a software version and vulnerability (based on CVE ID), it is flagged. The module then displays an alert with results, and the findigs are stored in a general vulnerability inventory. You can query this inventory to review vulnerability alerts and details.

## Vulnerability Detector Provider (VDP)
The VDP organizes data from various providers. This allows the Vulnerability Detection module to fill gaps of vulnerability knowledge for a complete picture across various operating systems. 

VDPs 3 functions are:
* Content Migration:  fetches raw vulnerability data from vendors and normalizes it using the CVE JSON v5 format. 
* Data Sanitization:  enhances the normalized data by fixing inconsistencies (like version mismatches or typos), and completing missing fields. 
* Content Merging:  combines vendor-specific content with internally maintained intelligence data, including product name mappings, product translations, and OS base rules. This allows for a single, unique document for each CVE that’s added to the database.

The CTI API makes the final document available to all Wazuh Managers. The Vulnerability Detection module retrieves intel by querying this CTI API, or an offline local repository. Outdated content in previous data is replaced by updated content.


## Configure Vulnerability Detection
On the Wazuh Manager, open the main configuration file:<br>
`sudo nano /var/ossec/etc/ossec.conf`

Ensure that the `<vulnerability-detection>` block contains an `<enabled>` tag with the content `yes`:
```
<vulnerability-detection>
    <enabled>yes</enabled>
    <index-status>yes</index-status>
    <feed-update-interval>60m</feed-update-interval>
  </vulnerability-detection>
```

This enables the Vulnerability Detection module for monitored endpoints.<br>
If you’d also like to enable Vulnerability Detection on the Wazuh Manager, you’ll need to open the sensitive `internal_options.conf` file on the Wazuh Manager.

This is a sensitive file with many options that you probably don’t want to change, so be very careful:<br>
`sudo nano /var/ossec/etc/internal_options.conf`

Scroll down to line 334, and you’ll find a property labelled `vulnerability-detection.disable_scan_manager`. You’ll need to change its value of `1` into a value of `0`:<br>
`vulnerability-detection.disable_scan_manager=0`